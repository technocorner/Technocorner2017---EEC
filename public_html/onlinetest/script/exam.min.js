var timer={
    max:0,
    localTime:{remaining:0,now:0},
    srvTime:{max:0,remaining:0,now:0},
    tickCallback:null,
    timeoutCallback:null,
    tick:function(){0==this.srvTime.max&&this.sync(),
        this.localTime.now=(new Date).getTime()/1e3,
        this.localTime.remaining=this.srvTime.max-this.localTime.now,
        setTimeout(function(){timer.tickCallback(timer.localTime.remaining),
        timer.localTime.remaining>0?timer.tick(timer.localTime.remaining):timer.timeoutCallback()},
                   1e3)},
    sync:function(){$.ajax({type:"get",
                            url:"exam/timer",
                            async:!1,
                            success:function(e){timer.srvTime.max=e.max,timer.srvTime.now=e.now,timer.srvTime.remaining=e.remaining},
                           error:function(e){console.error("Timer can't be synced. Will use local time instead. Cause : "+e.message)}})}};$(document).ready(function(){function e(){for(var e=$("div.row.question").get(),
                           a=0;a<e.length;a++){var i=localStorage.getItem(t+"-"+e[a].id);null!=i&&$("#"+e[a].id+" input[value="+i+"]").prop("checked",!0)}}function a(){var e=$("#exam_id").val(),a=$(".exam-paper").attr("data-subjectId");$.ajax({type:"get",url:"/user/exam/get-answer",
                           data:{exam_id:e,subject_id:a},success:function(e){var a=($("div.row.question").get(),e.question);a.forEach(function(e){var a=$(".question#"+e.question_id);a.length&&(a.find("input[value="+e.answer+"]").prop("checked",!0),console.log(a.find("[name="+e.exam_id+"-ch]:checked")))})},error:function(){console.error("Jawaban gagal dimuat dari server, memuat dari simpanan local")}})}function i(e){var a=[],i=$("#exam_id").val();$(".question").each(function(){var e={},i=this.id;e.id=i,e.answer=$(this).find("[name="+i+"-ch]:checked").val(),e.answer&&a.push(e)});for(var t=$("form").attr("id").replace("-paper",""),n=0;n<localStorage.length;n++){var r={},o=localStorage.key(n),c=o.split("-")[0];if(r.id=o.split("-")[1],c!=t){r.answer=localStorage.getItem(o);var l=r.answer;("A"==l||"B"==l||"C"==l||"D"==l||"E"==l)&&a.push(r)}}$.ajax({async:!1,type:"POST",url:"/user/exam/submit",data:{answers:a,exam_id:i},success:function(){e()},error:function(){alert("Gagal menyimpan jawaban, harap mengulangi menekan tombol.")}})}$(window).keydown(function(e){return 13==e.keyCode?!1:!0});var t=$("form").attr("id").replace("-paper","");$(".choice-radio").click(function(){var e=$(this).attr("name").split("-")[0],a=$(this).attr("value");""!=a&&localStorage.setItem(t+"-"+e,a)}),e(),a(),timer.tickCallback=function(e){e=Math.floor(e),console.log("callback rem : "+e);var a=Math.floor(e/60/60%24),i=Math.floor(e/60%60),t=Math.floor(e%60),n="timer col-sm-1 ";1==a&&i>40?n+="time-relax":1==a&&i>0?n+="time-running":0==a&&i>20?n+="time-warning":0==a&&20>i&&(n+="time-critical"),console.log("class : "+n+"; m : "+i),$(".timer").attr("class",n),10>a&&(a="0"+a.toString()),10>i&&(i="0"+i.toString()),10>t&&(t="0"+t.toString()),$(".timer").html(a+" : "+i+" : "+t)},timer.timeoutCallback=function(){$("input[type=submit]").trigger("click")},timer.tick(),$(".exam-paper").submit(function(e){e.preventDefault();var a=this;i(a.submit())}),$(".subject-link").on("click",function(e){e.preventDefault();var a=this;i(function(){window.location=a.href})})});